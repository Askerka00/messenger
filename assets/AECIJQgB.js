import{i as m,r as v,F as k,o as C,e as M,v as l,x as s,y as i,J as t,K as g,L as p,M as B,N as T,O as U,P as L,Q as S,t as a,R as b,B as E,S as N}from"./D1Ovq820.js";import{u as V}from"./AJK-pmH7.js";const K={class:"flex h-screen"},D={class:"w-1/4 bg-gray-200 p-4"},F={class:"flex justify-between"},R={class:"text-xl mb-4"},j=["onClick"],z={class:"w-3/4 p-4 h-screen"},H={key:0,class:"text-2xl mb-4"},J={key:1,class:"text-2xl mb-4"},O={class:"overflow-auto flex-grow mb-4"},P={key:2,class:"flex"},Q=["disabled"],I={__name:"chat",setup(W){const c=V(),h=m(()=>c.currentUser),w=m(()=>c.users.filter(r=>r!==c.currentUser)),o=v(null),n=v(""),f=m(()=>c.getMessages(o.value)),d=v(null);k(f,()=>{N(()=>{d.value&&(d.value.scrollTop=d.value.scrollHeight)})});const y=r=>{o.value!==r&&(o.value=r)},x=()=>{n.value.trim()&&o.value&&(c.sendMessage(o.value,n.value),n.value="")},_=r=>{r.key==="messages"&&c.loadMessages()};return C(()=>{window.addEventListener("storage",_)}),M(()=>{window.removeEventListener("storage",_)}),(r,u)=>(a(),l("div",K,[s("aside",D,[s("div",F,[u[1]||(u[1]=s("h2",{class:"text-xl mb-4"},"Чаты",-1)),s("h2",R,i(t(h)),1)]),(a(!0),l(g,null,p(t(w),e=>(a(),l("div",{key:e,class:"mb-4"},[s("button",{class:b({"block w-full text-left px-4 py-2 rounded shadow":!0,"bg-green-200":e===t(o),"bg-white":e!==t(o)}),onClick:q=>y(e)},i(e),11,j)]))),128))]),s("main",z,[s("div",{ref_key:"messagesContainer",ref:d,class:"relative h-full flex flex-col"},[t(o)?(a(),l("h2",J,"Чат с "+i(t(o)),1)):(a(),l("h2",H,"Выберите чат")),s("div",O,[(a(!0),l(g,null,p(t(f),e=>(a(),l("div",{key:e.timestamp,class:b(["mb-2 p-2 rounded",{"bg-blue-100 text-right":e.sender===t(h),"bg-gray-100 text-left":e.sender!==t(h)}])},[s("p",null,[s("strong",null,i(e.sender)+":",1),E(" "+i(e.message),1)]),s("small",null,i(e.timestamp),1)],2))),128))]),t(o)?(a(),l("div",P,[B(s("input",{"onUpdate:modelValue":u[0]||(u[0]=e=>U(n)?n.value=e:null),placeholder:"Введите сообщение...",class:"flex-grow border rounded px-4 py-2",onKeyup:L(x,["enter"])},null,544),[[T,t(n)]]),s("button",{class:"ml-2 px-4 py-2 bg-green-500 text-white rounded",onClick:x,disabled:!t(n).trim()}," Отправить ",8,Q)])):S("",!0)],512)])]))}};export{I as default};
